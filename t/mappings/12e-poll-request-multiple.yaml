template: poll-req.tt

vars:

input_assertions:
  class: SRS::EPP::Command::Poll
  match:

SRS:
 - assertions:
     count:
       - [ '/NZSRSRequest/*', 1, 'SRS: there is 1 srs command' ]
       - [ '/NZSRSRequest/GetMessages/TypeFilter', 2, 'SRS: Check there are both typefilters' ]
     attr_is:
       - [ '/NZSRSRequest/GetMessages', 'QueueMode', '1', 'SRS: Get message correct' ]
       - [ '/NZSRSRequest/GetMessages', 'MaxResults', '10', 'SRS: request wants just one row' ]
   fake_response: |-
      <NZSRSResponse VerMajor="5" VerMinor="0">
      <Response Action="GetMessages" FeId="8" FeSeq="4798947" OrigRegistrarId="90" RecipientRegistrarId="90" Rows="4">
      <FeTimeStamp Day="7" Hour="10" Minute="18" Month="7" Second="14" TimeZoneOffset="+12:00" Year="2010"/>
      <Message Remaining="0">
      <Response Action="DomainTransfer" FeId="8" FeSeq="4798848" OrigRegistrarId="1" RecipientRegistrarId="90" TransId="srsrps-1_376">
      <FeTimeStamp Day="7" Hour="09" Minute="13" Month="7" Second="01" TimeZoneOffset="+12:00" Year="2010"/>
      <DomainTransfer Day="7" Hour="09" Minute="13" Month="7" Second="01" TimeZoneOffset="+12:00" Year="2010" RegistrarName="Catalyst.Net Ltd">
      <TransferredDomain>
      <![CDATA[whois.net.te]]>
      </TransferredDomain>
      </DomainTransfer>
      </Response>
      </Message>
      <Message Remaining="0">
      <Response Action="DomainUpdate" FeId="8" FeSeq="4798901" OrigRegistrarId="1" RecipientRegistrarId="90" Rows="1" TransId="srsrps-1_377">
      <FeTimeStamp Day="7" Hour="09" Minute="43" Month="7" Second="50" TimeZoneOffset="+12:00" Year="2010"/>
      <Domain Delegate="1" DomainName="cliche.net.te" RegistrarId="90" Status="Active" Term="1" UDAI="daUx6t7f">
      <RegistrantContact Name="Big Chesse" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </RegistrantContact>
      <AdminContact Name="Big Cheese" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </AdminContact>
      <TechnicalContact Name="Update test 2" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </TechnicalContact>
      <BilledUntil Day="16" Hour="10" Minute="44" Month="7" Second="41" TimeZoneOffset="+12:00" Year="2010"/>
      <RegisteredDate Day="16" Hour="10" Minute="44" Month="1" Second="41" TimeZoneOffset="+13:00" Year="2008"/>
      <AuditDetails ActionId="srsrps-1_377" RegistrarId="1">
      <AuditTime>
      <From Day="07" Hour="09" Minute="43" Month="7" Second="50" TimeZoneOffset="+12:00" Year="2010"/>
      </AuditTime>
      <AuditText>
      <![CDATA[manual transfer evan]]>
      </AuditText>
      </AuditDetails>
      </Domain>
      </Response>
      </Message>
      <Message Remaining="0">
      <Response Action="DomainUpdate" FeId="8" FeSeq="4798907" OrigRegistrarId="1" RecipientRegistrarId="90" Rows="1" TransId="srsrps-1_378">
      <FeTimeStamp Day="7" Hour="09" Minute="45" Month="7" Second="31" TimeZoneOffset="+12:00" Year="2010"/>
      <Domain Delegate="1" DomainName="cliche.net.te" RegistrarId="90" Status="Active" Term="1" UDAI="PqC9VFP8">
      <RegistrantContact Name="brie" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </RegistrantContact>
      <AdminContact Name="brie" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </AdminContact>
      <TechnicalContact Name="Update test 2" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </TechnicalContact>
      <BilledUntil Day="16" Hour="10" Minute="44" Month="7" Second="41" TimeZoneOffset="+12:00" Year="2010"/>
      <RegisteredDate Day="16" Hour="10" Minute="44" Month="1" Second="41" TimeZoneOffset="+13:00" Year="2008"/>
      <AuditDetails ActionId="srsrps-1_378" RegistrarId="1">
      <AuditTime>
      <From Day="07" Hour="09" Minute="45" Month="7" Second="31" TimeZoneOffset="+12:00" Year="2010"/>
      </AuditTime>
      <AuditText>
      <![CDATA[User Id: evan]]>
      </AuditText>
      </AuditDetails>
      </Domain>
      </Response>
      </Message>
      <Message Remaining="0">
      <Response Action="DomainCreate" FeId="8" FeSeq="4798918" OrigRegistrarId="90" RecipientRegistrarId="90" TransId="dbcreatetest04 7/07/2010 create 02">
      <FeTimeStamp Day="7" Hour="09" Minute="54" Month="7" Second="17" TimeZoneOffset="+12:00" Year="2010"/>
      <Domain Delegate="1" DomainName="dbcreatetest04.co.te" RegistrantRef="ref" RegistrarId="90" Status="Active" Term="1" UDAI="xXnhFrjA">
      <NameServers>
      <Server FQDN="internette.gen.te"/>
      <Server FQDN="ns1.actrix.ac.te"/>
      </NameServers>
      <RegistrantContact HandleId="uxb40" Name="uxb40Handle uxb2" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </RegistrantContact>
      <AdminContact HandleId="uxb40" Name="uxb40Handle uxb2" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </AdminContact>
      <TechnicalContact Name="Update test 2" Email="nowhere@hidden.co.te">
      <PostalAddress Address1="Street Address"/>
      <Phone AreaCode="4" CountryCode="64" LocalNumber="123456"/>
      </TechnicalContact>
      <BilledUntil Day="07" Hour="09" Minute="54" Month="8" Second="17" TimeZoneOffset="+12:00" Year="2010"/>
      <RegisteredDate Day="07" Hour="09" Minute="54" Month="7" Second="17" TimeZoneOffset="+12:00" Year="2010"/>
      <AuditDetails ActionId="dbcreatetest04 7/07/2010 create 02" RegistrarId="90">
      <AuditTime>
      <From Day="07" Hour="09" Minute="54" Month="7" Second="17" TimeZoneOffset="+12:00" Year="2010"/>
      </AuditTime>
      <AuditText>
      <![CDATA[One month domain used to monitor whois useage]]>
      </AuditText>
      </AuditDetails>
      </Domain>
      </Response>
      </Message>
      </Response>
      </NZSRSResponse>

   
output_assertions:
  count:
    - [ '//domain:exDate', 0, 'EPP: not distracted by any renewals' ]
    - [ '//domain:trDate', 1, 'EPP: found the transfer' ]
    - [ '//domain:pw', 0,  'EPP: not distracted by new UDAIs' ]
  attr_is:
    - [ '//epp:result', 'code', 1301, 'EPP: Correct response code' ]
    - [ '//epp:msgQ', 'count', 4, 'EPP: Correct number of outstanding messages' ]


