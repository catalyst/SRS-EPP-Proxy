template: update-domain.tt

vars:
  domain: cheese.co.te
  tech: registrant-001

input_assertions:
  class: SRS::EPP::Command::Update::Domain
  count:
    - [ '//domain:name', 1, 'SRS: Check for the domain' ]
    - [ '//domain:add/domain:contact', 1, 'SRS: Check the new tech' ]
    - [ '//domain:rem/domain:contact', 0, 'SRS: Check old tech' ]
  match:
    - [ '//domain:name', 'cheese.co.te', 'SRS: Check the domain name' ]
    - [ '//domain:add/domain:contact', 'registrant-001', 'SRS: Check the new tech' ]
  match_all:
    - [ '//domain:contact/@type', 'tech', 'SRS: Check all contacts are of type tech' ]

SRS:
  - assertions:
      count:
      match:
        - [ '//DomainNameFilter', 'cheese.co.te', 'SRS: Check for the domain name' ]
      match_all:
      attr_is:
        - [ '//TechnicalContact', 'HandleId', 'registrant-001', 'SRS: Check for the tech contact' ]
    fake_response: |-
      <NZSRSResponse VerMajor="5" VerMinor="0">
        <Response Action="DomainUpdate" FeId="8" FeSeq="4803306" OrigRegistrarId="90" RecipientRegistrarId="90" Rows="1" TransId="brause8769">
          <FeTimeStamp Day="8" Hour="15" Minute="23" Month="7" Second="27" TimeZoneOffset="+12:00" Year="2010"/>
          <Domain Delegate="1" DomainName="wicked-yeah.co.nz" RegistrarId="90" Status="Active" Term="1" UDAI="GbtMuYY9">
            <NameServers>
              <Server FQDN="ns1.hidns.com"/>
              <Server FQDN="ns2.hidns.com"/>
              <Server FQDN="ns3.hidns.com"/>
            </NameServers>
            <RegistrantContact ActionId="Update handle registrant-001 1" Email="new001@registrant.co.nz" HandleId="registrant-001" Name="new registrant 001">
              <PostalAddress Address1="Regisrant New Address 1" City="Wellington" CountryCode="NZ"/>
              <Phone AreaCode="4" CountryCode="64" LocalNumber="123 ext 1"/>
              <Fax AreaCode="4" CountryCode="64" LocalNumber="123666"/>
            </RegistrantContact>
            <AdminContact ActionId="Update handle registrant-001 1" Email="new001@registrant.co.nz" HandleId="registrant-001" Name="new registrant 001">
              <PostalAddress Address1="Regisrant New Address 1" City="Wellington" CountryCode="NZ"/>
              <Phone AreaCode="4" CountryCode="64" LocalNumber="123 ext 1"/>
              <Fax AreaCode="4" CountryCode="64" LocalNumber="123666"/>
            </AdminContact>
            <TechnicalContact ActionId="Update handle registrant-001 1" Email="new001@registrant.co.nz" HandleId="registrant-001" Name="new registrant 001">
              <PostalAddress Address1="Regisrant New Address 1" City="Wellington" CountryCode="NZ"/>
              <Phone AreaCode="4" CountryCode="64" LocalNumber="123 ext 1"/>
              <Fax AreaCode="4" CountryCode="64" LocalNumber="123666"/>
            </TechnicalContact>
            <BilledUntil Day="06" Hour="13" Minute="19" Month="8" Second="58" TimeZoneOffset="+12:00" Year="2010"/>
            <RegisteredDate Day="06" Hour="13" Minute="19" Month="7" Second="58" TimeZoneOffset="+12:00" Year="2010"/>
            <AuditDetails ActionId="brause8769" RegistrarId="90">
              <AuditTime>
                <From Day="08" Hour="15" Minute="23" Month="7" Second="27" TimeZoneOffset="+12:00" Year="2010"/>
              </AuditTime>
              <AuditText/>
            </AuditDetails>
          </Domain>
        </Response>
      </NZSRSResponse>

output_assertions:
  count:
    - [ '//epp:result', 1, 'SRS: Check for one result' ]
  attr_is:
    - [ '//epp:result', 'code', 1000, 'SRS: Check for correct result code' ]
